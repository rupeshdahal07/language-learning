{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}{% if is_edit %}Edit{% else %}Create{% endif %} Combined Words{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white/90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 mb-6">
            <h1 class="text-4xl font-bold text-center bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
                {% if is_edit %}Edit{% else %}Create{% endif %} Combined Words Exercise
            </h1>
            <p class="text-center text-gray-600">
                {% if is_edit %}
                    Update the combined words exercise details
                {% else %}
                    Create a new exercise combining multiple letters into words
                {% endif %}
            </p>
        </div>

        <!-- Error/Success Messages -->
        {% if error %}
            <div class="bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded-xl mb-6 shadow-lg">
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    {{ error }}
                </div>
            </div>
        {% endif %}
        
        {% if success %}
            <div class="bg-green-100 border border-green-400 text-green-700 px-6 py-4 rounded-xl mb-6 shadow-lg">
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    {{ success }}
                </div>
            </div>
        {% endif %}

        <!-- Main Form -->
        <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-8">
            <form method="POST" enctype="multipart/form-data" class="space-y-8">
                {% csrf_token %}
                
                <!-- Path and Lesson Selection -->
                <div class="bg-blue-50 rounded-xl p-6 border border-blue-200">
                    <h3 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                        </svg>
                        Path & Lesson Assignment
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="path_id" class="block text-sm font-medium text-gray-700 mb-2">Select Path</label>
                            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" id="path_id" name="path_id">
                                <option value="">Choose a path...</option>
                                {% for path in path_ids %}
                                    <option value="{{ path.id }}">{{ path.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="lesson_id" class="block text-sm font-medium text-gray-700 mb-2">Select Lesson *</label>
                            <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200" id="lesson_id" name="lesson_id" required>
                                <option value="">Choose a lesson...</option>
                                {% for lesson in lesson_ids %}
                                    <option value="{{ lesson.id }}">{{ lesson.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Basic Information -->
                <div class="bg-purple-50 rounded-xl p-6 border border-purple-200">
                    <h3 class="text-lg font-semibold text-purple-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        Basic Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {% comment %} <div>
                            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">Exercise Title *</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200" 
                                   id="title" name="title" value="{% if is_edit %}{{ combined_words.title }}{% endif %}" required>
                        </div> {% endcomment %}
                        <div>
                            <label for="letter_info_title" class="block text-sm font-medium text-gray-700 mb-2">Letter Info Title *</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200" 
                                   id="letter_info_title" name="letter_info_title" value="{% if is_edit %}{{ combined_words.letter_info.title }}{% endif %}" required>
                        </div>
                    </div>
                    <div class="mt-6">
                        <label for="letter_info_meaning" class="block text-sm font-medium text-gray-700 mb-2">Meaning *</label>
                        <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200" 
                               id="letter_info_meaning" name="letter_info_meaning" placeholder="e.g., いえ = House"
                               value="{% if is_edit %}{{ combined_words.letter_info.meaning }}{% endif %}" required>
                    </div>
                </div>

                <!-- Individual Letters Section -->
                <div class="bg-green-50 rounded-xl p-6 border border-green-200">
                    <h3 class="text-lg font-semibold text-green-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                        </svg>
                        Individual Letters/Words
                    </h3>
                    <div id="letters_container" class="space-y-4">
                        {% if is_edit and combined_words.letter_info.combinedWords.nepaliLetters %}
                            {% for nepali_letter in combined_words.letter_info.combinedWords.nepaliLetters %}
                                <div class="letter-pair bg-white rounded-lg p-4 border border-green-300 shadow-sm">
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end">
                                        <div class="lg:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Nepali Letter {{ forloop.counter }}</label>
                                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200" 
                                                   name="nepali_letter_{{ forloop.counter0 }}" value="{{ nepali_letter|slice:'33:-16' }}" required>
                                        </div>
                                        <div class="lg:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Japanese Letter {{ forloop.counter }}</label>
                                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200" 
                                                   name="japanese_letter_{{ forloop.counter0 }}" value="{{ combined_words.letter_info.combinedWords.japaneseLetters|index:forloop.counter0 }}" required>
                                        </div>
                                        <div class="lg:col-span-1">
                                            <button type="button" class="w-full px-4 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium remove-letter">
                                                Remove
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="letter-pair bg-white rounded-lg p-4 border border-green-300 shadow-sm">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end">
                                    <div class="lg:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nepali Letter 1</label>
                                        <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200" 
                                               name="nepali_letter_0" required>
                                    </div>
                                    <div class="lg:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Japanese Letter 1</label>
                                        <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200" 
                                               name="japanese_letter_0" required>
                                    </div>
                                    <div class="lg:col-span-1">
                                        <button type="button" class="w-full px-4 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium remove-letter">
                                            Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="letter-pair bg-white rounded-lg p-4 border border-green-300 shadow-sm">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end">
                                    <div class="lg:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nepali Letter 2</label>
                                        <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200" 
                                               name="nepali_letter_1" required>
                                    </div>
                                    <div class="lg:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Japanese Letter 2</label>
                                        <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200" 
                                               name="japanese_letter_1" required>
                                    </div>
                                    <div class="lg:col-span-1">
                                        <button type="button" class="w-full px-4 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium remove-letter">
                                            Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <button type="button" class="mt-4 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors font-medium shadow-lg" id="add_letter">
                        <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                        Add Another Letter
                    </button>
                </div>

                <!-- Combined Words Section -->
                <div class="bg-yellow-50 rounded-xl p-6 border border-yellow-200">
                    <h3 class="text-lg font-semibold text-yellow-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 7a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 13a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                        </svg>
                        Combined Words
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="combined_nepali_words" class="block text-sm font-medium text-gray-700 mb-2">Combined Nepali Word *</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200" 
                                   id="combined_nepali_words" name="combined_nepali_words" 
                                   value="{% if is_edit %}{{ combined_words.letter_info.combinedWords.combinedNepaliWords|slice:'33:-16' }}{% endif %}" required>
                        </div>
                        <div>
                            <label for="combined_japanese_words" class="block text-sm font-medium text-gray-700 mb-2">Combined Japanese Word *</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all duration-200" 
                                   id="combined_japanese_words" name="combined_japanese_words" 
                                   value="{% if is_edit %}{{ combined_words.letter_info.combinedWords.combinedJapaneseWords }}{% endif %}" required>
                        </div>
                    </div>
                </div>

                <!-- Meaning Section -->
                <div class="bg-indigo-50 rounded-xl p-6 border border-indigo-200">
                    <h3 class="text-lg font-semibold text-indigo-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                        </svg>
                        Examples
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label for="romaji" class="block text-sm font-medium text-gray-700 mb-2">Romaji *</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200" 
                                   id="romaji" name="romaji" value="{% if is_edit %}{{ combined_words.meaning.romaji }}{% endif %}" required>
                        </div>
                        <div>
                            <label for="english" class="block text-sm font-medium text-gray-700 mb-2">English *</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200" 
                                   id="english" name="english" value="{% if is_edit %}{{ combined_words.meaning.english }}{% endif %}" required>
                        </div>
                        <div>
                            <label for="japanese_meaning" class="block text-sm font-medium text-gray-700 mb-2">Japanese *</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200" 
                                   id="japanese_meaning" name="japanese_meaning" value="{% if is_edit %}{{ combined_words.meaning.japanese }}{% endif %}" required>
                        </div>
                    </div>
                </div>

                <!-- Use Cases Section -->
                <div class="bg-pink-50 rounded-xl p-6 border border-pink-200">
                    <h3 class="text-lg font-semibold text-pink-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd"/>
                        </svg>
                        Use Cases (wrape preeti font with <>)
                    </h3>
                    <div id="use_cases_container" class="space-y-3">
                        {% if is_edit and combined_words.use_cases %}
                            {% for use_case in combined_words.use_cases %}
                                <div class="use-case-group">
                                    <div class="flex gap-3">
                                        <input type="text" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200" 
                                               name="use_case_{{ forloop.counter0 }}" value="{{ use_case }}" placeholder="Enter use case">
                                        <button type="button" class="px-4 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium remove-use-case">
                                            Remove
                                        </button>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="use-case-group">
                                <div class="flex gap-3">
                                    <input type="text" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200" 
                                           name="use_case_0" placeholder="Enter use case">
                                    <button type="button" class="px-4 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium remove-use-case">
                                        Remove
                                    </button>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <button type="button" class="mt-4 px-6 py-3 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors font-medium shadow-lg" id="add_use_case">
                        <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                        </svg>
                        Add Use Case
                    </button>
                </div>

                <!-- Image Upload -->
                <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"/>
                        </svg>
                        Image Upload
                    </h3>
                    <div>
                        <label for="image" class="block text-sm font-medium text-gray-700 mb-2">Upload Image</label>
                        <input type="file" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all duration-200" 
                               id="image" name="image" accept="image/*">
                        {% if is_edit and combined_words.image_url %}
                            <p class="mt-2 text-sm text-gray-500">Current image: {{ combined_words.image_url }}</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-end space-x-4 pt-6">
                    <a href="{% url 'list_combined_words' %}" class="px-8 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium shadow-lg">
                        Cancel
                    </a>
                    <button type="submit" class="px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 font-medium shadow-lg">
                        {% if is_edit %}
                            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                            </svg>
                            Update Combined Words
                        {% else %}
                            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                            </svg>
                            Create Combined Words
                        {% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
let letterIndex = {% if is_edit and combined_words.letter_info.combinedWords.nepaliLetters %}{{ combined_words.letter_info.combinedWords.nepaliLetters|length }}{% else %}2{% endif %};
let useCaseIndex = {% if is_edit and combined_words.use_cases %}{{ combined_words.use_cases|length }}{% else %}1{% endif %};

// Add letter functionality
document.getElementById('add_letter').addEventListener('click', function() {
    const container = document.getElementById('letters_container');
    const newLetterPair = document.createElement('div');
    newLetterPair.className = 'letter-pair bg-white rounded-lg p-4 border border-green-300 shadow-sm';
    newLetterPair.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end">
            <div class="lg:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Nepali Letter ${letterIndex + 1}</label>
                <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200" 
                       name="nepali_letter_${letterIndex}" required>
            </div>
            <div class="lg:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Japanese Letter ${letterIndex + 1}</label>
                <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200" 
                       name="japanese_letter_${letterIndex}" required>
            </div>
            <div class="lg:col-span-1">
                <button type="button" class="w-full px-4 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium remove-letter">
                    Remove
                </button>
            </div>
        </div>
    `;
    container.appendChild(newLetterPair);
    letterIndex++;
    updateLetterIndices();
});

// Remove letter functionality
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('remove-letter')) {
        const letterPairs = document.querySelectorAll('.letter-pair');
        if (letterPairs.length > 2) { // Keep at least 2 letters
            e.target.closest('.letter-pair').remove();
            updateLetterIndices();
        } else {
            alert('At least 2 letters are required for combined words.');
        }
    }
});

// Update letter indices after removal
function updateLetterIndices() {
    const letterPairs = document.querySelectorAll('.letter-pair');
    letterPairs.forEach((pair, index) => {
        const nepaliInput = pair.querySelector('input[name^="nepali_letter_"]');
        const japaneseInput = pair.querySelector('input[name^="japanese_letter_"]');
        const labels = pair.querySelectorAll('label');
        const nepaliLabel = labels[0];
        const japaneseLabel = labels[1];

        nepaliInput.name = `nepali_letter_${index}`;
        japaneseInput.name = `japanese_letter_${index}`;
        nepaliLabel.textContent = `Nepali Letter ${index + 1}`;
        japaneseLabel.textContent = `Japanese Letter ${index + 1}`;
    });
    letterIndex = letterPairs.length;
}

// Add use case functionality
document.getElementById('add_use_case').addEventListener('click', function() {
    const container = document.getElementById('use_cases_container');
    const newUseCase = document.createElement('div');
    newUseCase.className = 'use-case-group';
    newUseCase.innerHTML = `
        <div class="flex gap-3">
            <input type="text" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200" 
                   name="use_case_${useCaseIndex}" placeholder="Enter use case">
            <button type="button" class="px-4 py-3 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium remove-use-case">
                Remove
            </button>
        </div>
    `;
    container.appendChild(newUseCase);
    useCaseIndex++;
});

// Remove use case functionality
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('remove-use-case')) {
        e.target.closest('.use-case-group').remove();
    }
});


</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const pathSelect = document.getElementById('path_id');
    const lessonSelect = document.getElementById('lesson_id');

    pathSelect.addEventListener('change', function() {
        const pathId = this.value;
        // Clear current lessons
        lessonSelect.innerHTML = '<option value="" disabled selected>Loading...</option>';
        fetch(`/get_lesson/${pathId}/`)
            .then(response => response.json())
            .then(data => {
                lessonSelect.innerHTML = '<option value="" disabled selected>Select a lesson</option>';
                if (data.lessons && data.lessons.length > 0) {
                    data.lessons.forEach(lesson => {
                        const option = document.createElement('option');
                        option.value = lesson.id;
                        option.textContent = lesson.lesson_title || lesson.id;
                        lessonSelect.appendChild(option);
                    });
                } else {
                    lessonSelect.innerHTML = '<option value="" disabled selected>No lessons found</option>';
                }
            })
            .catch(() => {
                lessonSelect.innerHTML = '<option value="" disabled selected>Error loading lessons</option>';
            });
    });
});
</script>   
{% endblock %}